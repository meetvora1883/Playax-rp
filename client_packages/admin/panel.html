<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>RAGE:MP Admin Panel</title>
<style>
  :root { --primary:#1f2a37; --secondary:#111827; --accent:#2563eb; --text:#ecf0f1; --warning:#e74c3c; --success:#2ecc71; }
  * { margin:0; padding:0; box-sizing:border-box; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Cantarell, Noto Sans, Ubuntu, Helvetica Neue, Arial; }
  body { background: radial-gradient(1200px 600px at 0 -20%, rgba(52,152,219,0.08), transparent), var(--primary); color:var(--text); }
  .admin-panel { display:flex; min-height:100vh; }
  .sidebar { width:260px; background:linear-gradient(180deg, #0b1220, #0b1220 50%, #0f172a); padding:20px; box-shadow:2px 0 10px rgba(0,0,0,.25); }
  .sidebar-header { padding-bottom:16px; border-bottom:1px solid rgba(255,255,255,.08); margin-bottom:16px; display:flex; align-items:center; gap:10px; }
  .pill { padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); font-size:12px; }
  .admin-info { display:flex; align-items:center; margin:12px 0 18px; }
  .admin-avatar { width:46px; height:46px; border-radius:50%; background:linear-gradient(135deg,#3498db,#2ecc71); display:flex; align-items:center; justify-content:center; font-weight:700; font-size:18px; }
  .admin-details { flex:1; }
  .admin-level { display:inline-block; padding:2px 8px; background:rgba(52,152,219,.25); border-radius:10px; font-size:12px; margin-top:4px; }
  .nav-item { padding:10px 12px; border-radius:8px; margin-bottom:6px; cursor:pointer; transition:background .15s, transform .05s; user-select:none; }
  .nav-item:hover { background: rgba(255,255,255,.06); }
  .nav-item.active { background: var(--accent); }
  .main-content { flex:1; padding:20px; }
  .section { display:none; }
  .section.active { display:block; }
  .section-header { margin-bottom:16px; padding-bottom:10px; border-bottom:1px solid rgba(255,255,255,.08); display:flex; align-items:center; justify-content:space-between; gap:10px; }
  .search-input { width:380px; padding:10px 12px; border:none; border-radius:8px; background:rgba(0,0,0,.25); color:var(--text); outline:none; }
  .player-list { display:grid; grid-template-columns: repeat(auto-fill,minmax(320px,1fr)); gap:14px; }
  .player-card { background: linear-gradient(180deg,#0b1220,#0b1220 60%,#111827); border-radius:10px; padding:14px; border:1px solid rgba(255,255,255,.06); }
  .player-header { display:flex; align-items:center; margin-bottom:10px; gap:10px; }
  .player-avatar { width:40px; height:40px; border-radius:50%; background:#2563eb; display:flex; align-items:center; justify-content:center; font-weight:700; }
  .player-id { font-size:12px; opacity:.7; }
  .player-stats { font-size:13px; opacity:.85; display:flex; flex-wrap:wrap; gap:10px; }
  .badges { margin-top:6px; display:flex; gap:6px; flex-wrap:wrap; }
  .badge { font-size:11px; padding:3px 6px; border-radius:999px; background:rgba(255,255,255,.06); }
  .player-actions { display:flex; flex-wrap:wrap; gap:6px; margin-top:10px; }
  .btn { padding:7px 10px; border:none; border-radius:6px; cursor:pointer; font-size:12px; transition:opacity .15s, transform .02s; }
  .btn:hover { opacity:.9; }
  .btn:active { transform: translateY(1px); }
  .btn-primary { background:#2563eb; color:#fff; }
  .btn-warning { background:#f39c12; color:#fff; }
  .btn-danger  { background:#e74c3c; color:#fff; }
  .btn-success { background:#2ecc71; color:#fff; }
  .btn-ghost { background:rgba(255,255,255,.08); color:#fff; }
  select { width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,.15); background:rgba(0,0,0,.25); color:#fff; outline:none; position: relative; z-index:10001; }
  .grid { display:grid; gap:12px; }
  .grid-2 { grid-template-columns: repeat(2, 1fr); }

  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:10000; align-items:center; justify-content:center; }
  .modal-content { background:linear-gradient(180deg,#0b1220,#111827); border-radius:10px; padding:16px; width:460px; max-width:92%; border:1px solid rgba(255,255,255,.08); }
  .modal-header { margin-bottom:12px; padding-bottom:8px; border-bottom:1px solid rgba(255,255,255,.08); }
  .modal-footer { display:flex; justify-content:flex-end; gap:10px; margin-top:14px; }

  .vehicle-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(150px,1fr)); gap:12px; }
  .vehicle-item { background: linear-gradient(180deg,#0b1220,#0b1220 60%,#111827); border-radius:10px; padding:12px; text-align:center; cursor:pointer; transition: transform .1s; border:1px solid rgba(255,255,255,.06); }
  .vehicle-item:hover { transform: translateY(-2px); }
  .soft { opacity:.8; font-size:12px; }
  .toolbar { display:flex; gap:8px; flex-wrap:wrap; }
  .category-tabs { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px; }
  .tab { padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.08); cursor:pointer; }
  .tab.active { background:#2563eb; }
  .info-block { padding:12px; background:rgba(255,255,255,.06); border-radius:8px; }
</style>
</head>
<body>
  <div class="admin-panel">
    <div class="sidebar">
      <div class="sidebar-header"><h2>Admin Panel</h2><span class="pill">J to toggle</span></div>
      <div class="admin-info">
        <div class="admin-avatar">A</div>
        <div class="admin-details">
          <div class="admin-name" id="admin-name">You</div>
          <div class="admin-level">Level <span id="admin-level">0</span></div>
        </div>
      </div>

      <div class="nav-item active" data-section="players">Players</div>
      <div class="nav-item" data-section="vehicles">Vehicles</div>
      <div class="nav-item" data-section="server">Server Controls</div>
      <div class="nav-item" data-section="bans">Ban Management</div>
      <div class="nav-item" data-section="logs">Action Logs</div>

      <div style="margin-top:14px" class="toolbar">
        <button class="btn btn-ghost" id="btn-invis-full">Invis Full</button>
        <button class="btn btn-ghost" id="btn-invis-partial">Invis Partial</button>
        <button class="btn btn-ghost" id="btn-invis-none">Invis None</button>
      </div>
      <div class="soft" style="margin-top:6px;">Quick Invis (affects how others see you)</div>
    </div>

    <div class="main-content">
      <!-- Players -->
      <div class="section active" id="players-section">
        <div class="section-header">
          <h2>Online Players</h2>
          <input type="text" class="search-input" placeholder="Search players..." id="player-search">
        </div>

        <div id="players-toolbar" class="toolbar" style="margin-bottom:10px;">
          <span class="soft">Quick actions (select in modal for more):</span>
          <button class="btn btn-primary" id="btn-refresh">Refresh</button>
        </div>

        <div class="player-list" id="player-list"></div>
      </div>

      <!-- Vehicles -->
      <div class="section" id="vehicles-section">
        <div class="section-header">
          <h2>Vehicle Spawner</h2>
          <input type="text" class="search-input" placeholder="Search vehicles..." id="vehicle-search">
        </div>

        <div class="category-tabs" id="vehicle-tabs"></div>
        <div class="toolbar" style="margin-bottom:10px;">
          <button class="btn btn-primary" id="spawn-car">Spawn (/car)</button>
          <button class="btn btn-success" id="spawn-carn">Spawn Keep (/carn)</button>
          <button class="btn btn-ghost" id="remove-cars">Remove All</button>
        </div>
        <div class="vehicle-grid" id="vehicle-grid"></div>
        <div class="soft" style="margin-top:8px;">Tip: add custom models to <code>packages/admin/data/vehicles.json</code> under <b>Custom</b>.</div>
      </div>

      <!-- Server Controls -->
      <div class="section" id="server-section">
        <div class="section-header"><h2>Server Controls</h2></div>
        <div class="grid grid-2">
          <div>
            <div class="soft" style="margin-bottom:6px;">Weather</div>
            <select id="weather-select">
              <option value="EXTRASUNNY">Extra Sunny</option>
              <option value="CLEAR">Clear</option>
              <option value="CLOUDS">Clouds</option>
              <option value="SMOG">Smog</option>
              <option value="FOGGY">Foggy</option>
              <option value="OVERCAST">Overcast</option>
              <option value="RAIN">Rain</option>
              <option value="THUNDER">Thunder</option>
              <option value="CLEARING">Clearing</option>
              <option value="NEUTRAL">Neutral</option>
              <option value="SNOW">Snow</option>
              <option value="BLIZZARD">Blizzard</option>
              <option value="SNOWLIGHT">Snowlight</option>
              <option value="XMAS">Xmas</option>
              <option value="HALLOWEEN">Halloween</option>
            </select>
            <button class="btn btn-primary" style="margin-top:8px;" id="apply-weather">Apply Weather</button>
          </div>
          <div>
            <div class="soft" style="margin-bottom:6px;">Time</div>
            <input type="time" class="search-input" id="time-input" />
            <button class="btn btn-primary" style="margin-top:8px;" id="apply-time">Apply Time</button>
          </div>
        </div>

        <div style="margin-top: 18px;">
          <h3 style="margin-bottom:8px;">Server Actions</h3>
          <div class="toolbar">
            <button class="btn btn-danger" id="restart-server">Restart Server</button>
            <button class="btn btn-warning" id="announce-button">Announcement</button>
          </div>
        </div>
      </div>

      <!-- Bans -->
      <div class="section" id="bans-section">
        <div class="section-header"><h2>Ban Management</h2></div>
        <div id="bans-guard" class="info-block" style="display:none;">🚫 Your level is below 8. You don’t have access to Ban Management.</div>
        <div id="bans-list" class="grid"></div>
      </div>

      <!-- Logs -->
      <div class="section" id="logs-section">
        <div class="section-header"><h2>Action Logs</h2></div>
        <div id="logs-container" class="grid"></div>
      </div>
    </div>
  </div>

  <!-- Player Modal -->
  <div class="modal" id="player-modal">
    <div class="modal-content">
      <div class="modal-header"><h3>Player Actions — <span id="modal-player-name"></span></h3></div>

      <div class="grid">
        <div>
          <div class="soft">Action</div>
          <select id="action-select">
            <option value="warn">Warn</option>
            <option value="kick">Kick</option>
            <option value="mute">Mute</option>
            <option value="unmute">Unmute</option>
            <option value="freeze">Freeze</option>
            <option value="unfreeze">Unfreeze</option>
            <option value="spectate">Spectate</option>
            <option value="teleport">Teleport to</option>
            <option value="bring">Bring</option>
            <option value="revive">Revive</option>
            <option value="slap">Slap</option>
            <option value="sethealth">Set Health</option>
            <option value="setarmor">Set Armor</option>
            <option value="setmoney">Set Money</option>
            <option value="giveweapon">Give Weapon</option>
            <option value="demorgan">DeMorgan / Jail</option>
            <option value="unjail">Unjail</option>
            <option value="tempban">Temporary Ban</option>
            <option value="ban">Permanent Ban</option>
          </select>
        </div>

        <div id="duration-group" style="display:none;">
          <div class="soft">Duration (e.g. 1h30m)</div>
          <input type="text" class="search-input" id="duration-input" placeholder="1h30m" />
        </div>

        <div id="value-group" style="display:none;">
          <div class="soft">Value</div>
          <input type="number" class="search-input" id="value-input" />
        </div>

        <div id="weapon-group" style="display:none;">
          <div class="soft">Weapon</div>
          <input type="text" class="search-input" id="weapon-input" value="WEAPON_PISTOL" />
          <div class="soft" style="margin-top:6px;">Ammo</div>
          <input type="number" class="search-input" id="ammo-input" value="100" />
        </div>

        <div>
          <div class="soft">Reason (optional)</div>
          <input type="text" class="search-input" id="reason-input" placeholder="Optional reason" />
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-primary" id="execute-action">Execute</button>
        <button class="btn" id="close-modal">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Announcement Modal -->
  <div class="modal" id="announce-modal">
    <div class="modal-content">
      <div class="modal-header"><h3>Server Announcement</h3></div>
      <div class="soft">Message</div>
      <textarea class="search-input" id="announce-message" rows="4"></textarea>
      <div class="modal-footer">
        <button class="btn btn-primary" id="send-announcement">Send</button>
        <button class="btn" id="close-announce-modal">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div class="modal" id="confirm-modal">
    <div class="modal-content">
      <div class="modal-header"><h3>Confirm Action</h3></div>
      <div id="confirm-text" style="margin:8px 0 12px;"></div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="confirm-yes">Yes</button>
        <button class="btn" id="confirm-no">No</button>
      </div>
    </div>
  </div>

<script>
  // ===== CEF <-> Game Bridge =====
  function callGame(action, payload={}) {
    if (typeof mp !== 'undefined' && mp.trigger) {
      mp.trigger("panel:exec", action, JSON.stringify(payload));
    } else {
      console.log("DEV call:", action, payload);
    }
    // Log locally (server has persistent logs too)
    addToLogs({ action, target: payload.playerId || payload.vehicle || payload.weather || payload.time || '', timestamp: new Date().toLocaleTimeString(), reason: payload.reason });
  }
  // Game -> CEF calls these:
  window.panelBridge = {
    setAdminLevel: (lvl)=>{ adminLevel=+lvl||0; document.getElementById('admin-level').textContent = String(adminLevel); applyPermissions(); },
    setPlayers: (arr)=>{ players = arr; renderPlayers(); },
    setBans: (arr)=>{ bans = arr; renderBans(); },
    setVehicles: (obj)=>{ vehiclesByCat = obj||{}; buildVehicleTabs(); renderVehicles(); },
    setLogs: (arr)=>{ logs = arr||[]; renderLogs(); }
  };

  // Tell game we're ready & grab focus
  document.body.tabIndex = -1; document.body.focus();
  if (typeof mp !== 'undefined' && mp.trigger) { mp.trigger("panel:ready"); }

  // ===== State =====
  let adminLevel = 0;
  let players = [];
  let bans = [];
  let logs = [];
  let vehiclesByCat = {};
  let selectedPlayer = null;
  let currentVehicleCategory = "Cars";
  let pendingConfirm = null;

  // ===== Init =====
  document.addEventListener('DOMContentLoaded', ()=>{
    setupNavigation();
    setupPlayers();
    setupVehicles();
    setupServer();
    setupGlobalKeys();
  });

  function setupNavigation(){
    const items = document.querySelectorAll('.nav-item');
    const sections = document.querySelectorAll('.section');
    items.forEach(item=>{
      item.addEventListener('click', ()=>{
        items.forEach(n=>n.classList.remove('active'));
        item.classList.add('active');
        sections.forEach(s=>s.classList.remove('active'));
        document.getElementById(item.dataset.section+'-section').classList.add('active');
      });
    });
  }

  function setupPlayers(){
    document.getElementById('player-search').addEventListener('input', renderPlayers);
    document.getElementById('close-modal').addEventListener('click', closeModal);
    document.getElementById('execute-action').addEventListener('click', executeAction);
    document.getElementById('action-select').addEventListener('change', toggleActionFields);
    document.getElementById('btn-refresh').addEventListener('click', ()=> {
      if (typeof mp !== 'undefined' && mp.trigger) { mp.trigger("panel:ready"); }
    });
  }

  function setupVehicles(){
    document.getElementById('vehicle-search').addEventListener('input', renderVehicles);
    document.getElementById('spawn-car').addEventListener('click', ()=> spawnSelectedVehicle('car'));
    document.getElementById('spawn-carn').addEventListener('click', ()=> spawnSelectedVehicle('carn'));
    document.getElementById('remove-cars').addEventListener('click', ()=> callGame('removecar', {}));
  }

  function setupServer(){
    document.getElementById('apply-weather').addEventListener('click', ()=> callGame('weather', { weather: document.getElementById('weather-select').value }));
    document.getElementById('apply-time').addEventListener('click', ()=> callGame('time', { time: document.getElementById('time-input').value }));
    document.getElementById('restart-server').addEventListener('click', ()=> confirmAction("Restart the server?", ()=> callGame('restart', {})));
    document.getElementById('announce-button').addEventListener('click', ()=> openModal('announce-modal'));
    document.getElementById('send-announcement').addEventListener('click', ()=> {
      const message = document.getElementById('announce-message').value.trim();
      if(message) callGame('announce', { message });
      closeModal('announce-modal');
    });
    document.getElementById('close-announce-modal').addEventListener('click', ()=> closeModal('announce-modal'));

    document.getElementById('btn-invis-full').addEventListener('click', ()=> callGame('invis_full', {}));
    document.getElementById('btn-invis-partial').addEventListener('click', ()=> callGame('invis_partial', {}));
    document.getElementById('btn-invis-none').addEventListener('click', ()=> callGame('invis_none', {}));
  }

  function setupGlobalKeys(){
    window.addEventListener('keydown', (e)=>{
      if(e.key === "Escape"){
        // close any open modal first
        const openModalEl = document.querySelector('.modal[style*="flex"]');
        if(openModalEl){ openModalEl.style.display='none'; return; }
        // otherwise ask client to close panel with PDA put-away animation
        if (typeof mp !== 'undefined' && mp.trigger) { mp.trigger("panel:requestClose"); }
      }
    });
  }

  function applyPermissions(){
    // Ban tab guard for < 8
    const guard = document.getElementById('bans-guard');
    if (adminLevel < 8) { guard.style.display = 'block'; }
    else { guard.style.display = 'none'; }
  }

  // ===== Players =====
  function renderPlayers(){
    const list = document.getElementById('player-list');
    const q = (document.getElementById('player-search').value || '').toLowerCase();
    list.innerHTML = '';
    players
      .filter(p => !q || (p.name||'').toLowerCase().includes(q) || String(p.id).includes(q))
      .forEach(p=>{
        const el = document.createElement('div');
        el.className = 'player-card';
        el.innerHTML = `
          <div class="player-header">
            <div class="player-avatar">${(p.name||'?').charAt(0)}</div>
            <div class="player-details">
              <div class="player-name">${p.name}</div>
              <div class="player-id">ID: ${p.id} | Ping: ${p.ping||0}ms</div>
            </div>
          </div>
          <div class="player-stats">
            <div>HP: ${p.health||0}</div>
            <div>Armor: ${p.armor||0}</div>
            <div>Money: ${p.money||0}</div>
            ${p.jailedUntil ? `<div>Jailed: ${new Date(p.jailedUntil).toLocaleTimeString()}</div>` : ""}
          </div>
          <div class="badges">${p.level>0?`<span class="badge">Admin L${p.level}</span>`:''}</div>
          <div class="player-actions">
            <button class="btn btn-primary" data-act="manage" data-id="${p.id}">Manage</button>
            <button class="btn btn-warning" data-act="warn"   data-id="${p.id}">Warn</button>
            <button class="btn btn-danger"  data-act="kick"   data-id="${p.id}">Kick</button>
            <button class="btn btn-ghost"   data-act="teleport" data-id="${p.id}">TP</button>
            <button class="btn btn-success" data-act="revive" data-id="${p.id}">Revive</button>
          </div>`;
        list.appendChild(el);
      });

    list.querySelectorAll('[data-act]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = parseInt(btn.getAttribute('data-id'));
        const act = btn.getAttribute('data-act');
        if (act === 'manage') openPlayerModal(id);
        else if (act === 'warn') callGame('warn', { playerId: id, reason: 'From panel' });
        else if (act === 'kick') confirmAction("Kick this player?", ()=> callGame('kick', { playerId: id, reason: 'From panel' }));
        else if (act === 'teleport') callGame('teleport', { playerId: id });
        else if (act === 'revive') callGame('revive', { playerId: id });
      });
    });
  }

  function openPlayerModal(playerId){
    selectedPlayer = players.find(p=>p.id===playerId) || null;
    if (!selectedPlayer) return;
    document.getElementById('modal-player-name').textContent = selectedPlayer.name;
    openModal('player-modal');
    toggleActionFields();
  }
  function closeModal(id){
    if(!id) id='player-modal';
    document.getElementById(id).style.display='none';
    if(id==='player-modal') selectedPlayer=null;
  }
  function openModal(id){ document.getElementById(id).style.display='flex'; }

  function toggleActionFields(){
    const act = document.getElementById('action-select').value;
    const showDur = ['mute','tempban','demorgan'].includes(act);
    const showVal = ['sethealth','setarmor','setmoney','slap'].includes(act);
    const showWea = ['giveweapon'].includes(act);
    document.getElementById('duration-group').style.display = showDur ? 'block':'none';
    document.getElementById('value-group').style.display = showVal ? 'block':'none';
    document.getElementById('weapon-group').style.display = showWea ? 'block':'none';
  }

  function confirmAction(text, onYes){
    pendingConfirm = onYes;
    document.getElementById('confirm-text').innerText = text;
    openModal('confirm-modal');
  }
  document.getElementById('confirm-yes').addEventListener('click', ()=>{ if(pendingConfirm) pendingConfirm(); pendingConfirm=null; closeModal('confirm-modal'); });
  document.getElementById('confirm-no').addEventListener('click', ()=>{ pendingConfirm=null; closeModal('confirm-modal'); });

  function executeAction(){
    if(!selectedPlayer) return;
    const act = document.getElementById('action-select').value;
    const duration = document.getElementById('duration-input').value;
    const value = document.getElementById('value-input').value;
    const reason = document.getElementById('reason-input').value;
    const weapon = document.getElementById('weapon-input').value;
    const ammo   = parseInt(document.getElementById('ammo-input').value || '100', 10);
    const payload = { playerId: selectedPlayer.id, duration, value, reason, weapon, ammo };
    const doIt = ()=>{ callGame(act, payload); closeModal('player-modal'); };

    if(['kick','ban','tempban','demorgan','slap','sethealth','setarmor','setmoney','giveweapon'].includes(act)){
      confirmAction(`Execute '${act}' on ${selectedPlayer.name}?`, doIt);
    }else{
      doIt();
    }
  }

  // ===== Vehicles =====
  function buildVehicleTabs(){
    const tabs = document.getElementById('vehicle-tabs');
    tabs.innerHTML='';
    Object.keys(vehiclesByCat).forEach(cat=>{
      const t=document.createElement('div'); t.className='tab'+(cat===currentVehicleCategory?' active':''); t.innerText=cat; t.addEventListener('click',()=>{ currentVehicleCategory=cat; document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); t.classList.add('active'); renderVehicles(); }); tabs.appendChild(t);
    });
  }
  let selectedVehicleName = null;
  function renderVehicles(){
    const grid = document.getElementById('vehicle-grid');
    const q = (document.getElementById('vehicle-search').value||'').toLowerCase();
    const list = (vehiclesByCat[currentVehicleCategory]||[]).filter(v=>!q || v.toLowerCase().includes(q));
    grid.innerHTML='';
    list.forEach(v=>{
      const el = document.createElement('div');
      el.className='vehicle-item';
      el.innerHTML = `<div style="font-size:28px;margin-bottom:6px;">🚗</div><div class="vehicle-name">${v}</div>`;
      el.addEventListener('click', ()=>{ selectedVehicleName = v; [...grid.querySelectorAll('.vehicle-item')].forEach(x=>x.style.outline=''); el.style.outline='2px solid #2563eb'; });
      grid.appendChild(el);
    });
  }
  function spawnSelectedVehicle(which){
    const v = selectedVehicleName || (vehiclesByCat[currentVehicleCategory]||[])[0] || "SULTAN";
    callGame(which==='car'?'car':'carn', { vehicle: v });
  }

  // ===== Bans =====
  function renderBans(){
    const list = document.getElementById('bans-list');
    list.innerHTML = '';
    if (adminLevel < 8){ document.getElementById('bans-guard').style.display='block'; return; }
    document.getElementById('bans-guard').style.display='none';
    if (!Array.isArray(bans) || bans.length===0){ list.innerHTML = '<div class="soft">No bans</div>'; return; }
    bans.forEach(b=>{
      const el=document.createElement('div'); el.className='player-card';
      const exp = b.expires? new Date(b.expires).toLocaleString() : 'Permanent';
      el.innerHTML = `<div style="font-weight:600;margin-bottom:6px;">${b.ident}</div><div class="soft">Reason: ${b.reason}</div><div class="soft">Expires: ${exp}</div>`;
      list.appendChild(el);
    });
  }

  // ===== Logs =====
  function renderLogs(){
    const c=document.getElementById('logs-container'); c.innerHTML='';
    (logs||[]).slice(-500).reverse().forEach(e=>{
      const el=document.createElement('div'); el.className='player-card';
      el.innerHTML = `<div><b>${new Date(e.ts||Date.now()).toLocaleString()}</b> — <b>${(e.admin&&e.admin.name)||'?'}</b> (L${(e.admin&&e.admin.level)||0}) did <code>${e.action}</code> ${e.target&&e.target.name?`on <b>${e.target.name}</b>`:''}${e.details?` <span class="soft">[${e.details}]</span>`:''}</div>`;
      c.appendChild(el);
    });
  }
</script>
</body>
</html>
